<aca-page-layout>
  <aca-search-ai-input-container
    class="aca-page-layout-header"
    placeholder="KNOWLEDGE_RETRIEVAL.SEARCH.RESULTS_PAGE.QUERY_INPUT_PLACEHOLDER"
    [agentId]="agentId"
    [useStoredNodes]="true">
  </aca-search-ai-input-container>
  <div class="aca-page-layout-content">
    <div class="aca-search-ai-results-container">
      <div
        class="aca-search-ai-results-container-query"
        data-automation-id="aca-search-ai-results-query">
        {{ searchQuery }}
      </div>
      <div class="aca-search-ai-response-container">
        <div class="aca-search-ai-response-container-body">
          <div
            class="aca-search-ai-response-container-body-response"
            data-automation-id="aca-search-ai-results-response">
            {{ queryAnswer?.answer }}
          </div>
          <button
            class="aca-search-ai-response-container-body-response-action aca-search-ai-response-container-body-response-action-regeneration"
            mat-icon-button
            (click)="performAiSearch()"
            data-automation-id="aca-search-ai-results-regeneration-button">
            <mat-icon>cached</mat-icon>
          </button>
          <button
            class="aca-search-ai-response-container-body-response-action"
            mat-icon-button
            (click)="copyResponseToClipboard()"
            data-automation-id="aca-search-ai-results-copying-button">
            <mat-icon>copy</mat-icon>
          </button>
          <button
            class="aca-search-ai-response-container-body-response-action"
            mat-icon-button
            data-automation-id="aca-search-ai-results-thumb-up-button">
            <mat-icon>thumb_up</mat-icon>
          </button>
          <button
            class="aca-search-ai-response-container-body-response-action aca-search-ai-response-container-body-response-action-thumb-down"
            mat-icon-button
            data-automation-id="aca-search-ai-results-thumb-down-button">
            <mat-icon>thumb_down</mat-icon>
          </button>
          <ng-container *ngIf="nodes?.length > 0">
            <mat-divider class="aca-search-ai-response-container-body-divider"></mat-divider>
            <div class="aca-search-ai-response-container-body-references-container">
              <h4 class="aca-search-ai-response-container-body-references-container-header">
                {{ 'KNOWLEDGE_RETRIEVAL.SEARCH.RESULTS_PAGE.REFERENCED_DOCUMENTS_HEADER' | translate }}
              </h4>
              <div class="aca-search-ai-response-container-body-references-container-documents">
                <div
                  class="aca-search-ai-response-container-body-references-container-documents-document"
                  *ngFor="let node of nodes"
                  [attr.data-automation-id]="'aca-search-ai-results-' + node.id + '-document'">
                  <mat-icon
                    mat-list-icon
                    class="aca-search-ai-response-container-body-references-container-documents-document-icon">
                    <img [alt]="node.content?.mimeType" [src]="mimeTypeIconsByNodeId[node.id]"/>
                  </mat-icon>
                  <div class="aca-search-ai-response-container-body-references-container-documents-document-name">
                    {{ node.name }}
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</aca-page-layout>
