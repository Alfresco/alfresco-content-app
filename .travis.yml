dist: trusty
sudo: required
services:
  - docker
addons:
  chrome: stable
  artifacts:
    s3_region: 'eu-west-2'
    paths:
      - e2e-output
    debug: true
language: node_js
node_js:
  - '8'
before_script:
  - sudo /etc/init.d/postgresql stop
before_install:
  - npm install -g npm@latest
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - sleep 3
jobs:
  include:
    - stage: test
      script:
        - npm run lint
        - npm run spellcheck
        - npm run format:check
    - stage: test
      script:
        - npm run test:ci
        - bash <(curl -s https://codecov.io/bash) -X gcov
    - stage: e2e
      script: npm run build && npm run e2e:docker
      deploy:
        skip_cleanup: true
        provider: s3
        access_key_id: $ARTIFACTS_KEY
        secret_access_key: $ARTIFACTS_SECRET
        bucket: $ARTIFACTS_BUCKET
        local-dir: e2e-output
        region: $ARTIFACTS_REGION
        on:
          repo: Alfresco/alfresco-content-app
          branch: development
