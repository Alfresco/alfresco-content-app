dist: trusty
sudo: required
services:
  - docker
addons:
  chrome: stable
language: node_js
node_js:
  - '10'
env:
  global:
    - SUITES_1=authentication,listViews,application,navigation,pagination
    - SUITES_2=search,actions,viewer,infoDrawer,extensions
before_script:
  - sudo /etc/init.d/postgresql stop
before_install:
  - npm install -g npm@latest
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - sleep 3
jobs:
  include:
    - stage: test
      name: 'Code quality checks'
      script:
        - npm run lint
    - name: 'Unit tests'
      script:
        - npm run test:ci
        - bash <(curl -s https://codecov.io/bash) -X gcov
    - stage: e2e
      name: 'Nginx testsuites $SUITES_1'
      script: npm run build.e2e && SUITE="--suite $SUITES_1" npm run e2e:docker
    - name: 'Nginx testsuites $SUITES_2'
      script: npm run build.e2e && SUITE="--suite $SUITES_2" npm run e2e:docker
    - name: 'Tomcat testsuites $SUITES_1'
      script: npm run build.tomcat.e2e && SUITE="--suite $SUITES_1" npm run docker.tomcat.e2e
    - name: 'Tomcat testsuites $SUITES_2'
      script: npm run build.tomcat.e2e && SUITE="--suite $SUITES_2" npm run docker.tomcat.e2e
