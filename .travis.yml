dist: trusty
sudo: required
services:
  - docker
addons:
  chrome: stable
language: node_js
node_js:
  - '8'
before_script:
  - sudo /etc/init.d/postgresql stop
before_install:
  - npm install -g npm@latest
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - sleep 3
jobs:
  include:
    - stage: test
      script:
        - npm run lint
        - npm run spellcheck
        - npm run format:check
    - stage: test
      script:
        - npm run test:ci
        - bash <(curl -s https://codecov.io/bash) -X gcov
    - stage: e2e
      script: npm run build && npm run e2e:docker
      deploy:
        skip_cleanup: true
        provider: s3
        access_key_id: AKIAYRB6VNHR4ECDP4GB
        secret_access_key:
          secure: Hrfp/9gLkTc35zaOsLw+jC/rtobiPwb6dEpoL2NoeyXTpkopI4AUrF8BdzL60kQ1ejEjbd5XMWxXfFI65JewBHxvb2AYn5q2/yAD0bF0L9ivrq+UD93PYpdKZlfaqLRZnA4WT13VkUdIpHpTtobzieJW01axdHPHIsSomIcNRuDf1f5aAl685ojgq0VxPFSB0SgZ9DIY/4qtPcS7XXu5YZwZ8oHae8CsrEjjTUNg9B7H0bupYskRBk1n/diJhPh3rR3k0TcbR4nMqni4w+i2nTcpzkocAZgALUREJn5LAqyFtFi4LMZGCGyi2hrdVkAfBg6OJ83qiBS6srE/Cy4I4uOaT0jRm9YVaXQawcCGDwm2k2rvybcExp/igH63+kIaWZ/51npxgm62YhV4WFwRyz238oiALjs8xnmTOqSnJA+qkL5yKxfQWm/OFmusKUHO4kCIpoTtWrEeUfD6PkDisLg9m0yua2xid2Q1h8w+MjdUFDWCTJfYXxoFj26KdvCsgF+n3ZoVBCI76X5xgWKr82zH9Bli563qjvFd8ockpVJoWEPi3Ukyn15XrTI7lAqsa+iPFvRmWc+S5dOf/4CsnQbnp4AI06J1dBDWI0nUev2OWI6dJ7iLL5bq3UBaJM7e43S63VcATK9ZLqtJDY3W5MmdmA/mbZemoIDvVzJrt34=
        bucket: aca-tests
        local-dir: e2e-output
        acl: private
        on:
          repo: Alfresco/alfresco-content-app
          branch: development
