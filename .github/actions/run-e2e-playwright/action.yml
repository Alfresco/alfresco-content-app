name: "Run e2e Playwright"
description: "Run e2e Playwright"

inputs:
  options:
    description: 'Options'
    required: true
  test-runner:
    description: 'Test runner'
    required: false
    default: 'Playwright'
  test-smoke:
    description: 'Test smoke'
    required: false
    default: false
  artifact-name:
    description: Name of the artifact cache
    required: true

runs:
  using: "composite"
  steps:

    - name: Setup and run with options
      shell: bash
      run: |
        npm start > /dev/null &\

        printf "Waiting for the application to be ready..."
        while ! curl -sf ${PLAYWRIGHT_E2E_HOST} > /dev/null; do
          printf "."
          sleep 1
        done
        printf "\nApplication is ready.\n"

        if [ "${{ inputs.test-smoke }}" == "true" ]; then
          echo "Running smoke tests with options ${{ inputs.options }}"
          npx nx run ${{ inputs.options }}-e2e:e2e --grep @smoke
        else
          echo "Running all tests with options ${{ inputs.options }}"
          npx nx run ${{ inputs.options }}-e2e:e2e
        fi
